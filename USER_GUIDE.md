# 未来便（Mirai-bin）使用書

## 目次

1. [未来便とは](#未来便とは)
2. [主な機能](#主な機能)
3. [使い方](#使い方)
4. [セキュリティとプライバシー](#セキュリティとプライバシー)
5. [よくある質問](#よくある質問)
6. [トラブルシューティング](#トラブルシューティング)

---

## 未来便とは

**未来便**は、親が子どもに宛てた手紙を、未来の特定タイミングで解錠できるアプリケーションです。90秒の音声録音から、AIが温かい手紙の下書きを作成し、暗号化して安全に保管します。指定した開封日時まで、誰も手紙の内容を読むことができません。

たとえ親が亡くなっても、子どもの人生の節目（小学校卒業、成人の日、結婚する日など）に、確実に想いを届けることができます。

---

## 主な機能

### 1. 音声録音（90秒）

マイクボタンを押して、子どもへの想いを90秒間録音します。録音中は波形が表示され、視覚的なフィードバックが得られます。

### 2. AI下書き生成

録音した音声は、Whisper APIによって自動的にテキストに変換されます。その後、Manus LLMが選択したテンプレートに基づいて、温かい手紙の下書きを生成します。

### 3. 手紙の編集

AI生成された下書きを自由に編集できます。言葉を追加したり、修正したりして、あなたらしい手紙に仕上げてください。

### 4. 開封日時の設定

手紙を開封できる日時を指定します。例えば「2030年4月1日 09:00（子どもの高校入学の日）」のように設定できます。

### 5. クライアント側暗号化（AES-GCM-256）

手紙の内容は、ブラウザ上でAES-GCM-256方式で暗号化されます。暗号化された状態でサーバーに保存されるため、サーバー管理者でも内容を読むことはできません。

### 6. Shamir分割による解錠制限

復号キーは**Shamir's Secret Sharing**によって3つのシェアに分割されます。そのうち2つのシェアがないと復号できません。

- **シェア1（clientShare）**: URLフラグメントに含まれる（受信者が保持）
- **シェア2（serverShare）**: サーバーが保持（**開封日時後にのみ提供**）
- **シェア3（backupShare）**: バックアップ用（オプション）

これにより、**開封日時前は技術的に復号不可能**です。開封日時が来るまで、誰も手紙を読むことができません。

### 7. OpenTimestamps証跡

手紙のハッシュ（SHA-256）がBitcoinブロックチェーンに刻印されます。これにより、手紙が改ざんされていないことを証明できます。

### 8. 共有リンク

手紙を保存すると、共有リンクが生成されます。このリンクをLINEやメールで子どもに送ることができます。

### 9. 下書き自動保存

手紙作成中に自動的に下書きが保存されます（3秒間隔）。途中で中断しても、後で続きから編集できます。

### 10. PWA対応

スマートフォンのホーム画面に「未来便」をインストールして、アプリのように使えます。オフライン時でも下書きを作成でき、オンライン復帰時に自動同期されます。

---

## 使い方

### 手紙を作成する

#### ステップ1: テンプレートを選択

1. ホームページの「手紙を書く」ボタンをクリック
2. カテゴリタブから適切なシーンを選択
   - 幼少期〜小学校
   - 中学校
   - 高校〜大学
   - 成人〜社会人
   - 人生の節目
   - 特別な日
3. テンプレートカードをクリックして選択

**利用可能なテンプレート（14種類）:**

- 10歳の誕生日に
- 小学校卒業の日に
- 中学校入学の日に
- 中学校卒業の日に
- 高校入学の日に
- 高校卒業の日に
- 大学入学の日に
- 成人の日に（18歳）
- 就職の日に
- 結婚する日に
- 子どもが生まれた日に
- 最初に恋をした日へ
- 辛いときに読んで
- いつか読んでほしい手紙

#### ステップ2: 受信者情報を入力

1. 受信者の名前を入力（例: 太郎）
2. 受信者との関係を選択（息子、娘、孫など）

#### ステップ3: 音声を録音

1. 「録音を開始」ボタンをクリック
2. マイクへのアクセスを許可
3. 90秒以内で子どもへの想いを話す
4. 録音中は波形が表示されます
5. 「録音を停止」ボタンをクリック、または90秒経過で自動停止

**録音のコツ:**

- 静かな場所で録音する
- マイクに近づきすぎない（20〜30cm程度）
- ゆっくり、はっきりと話す
- 感情を込めて、自然に話す

#### ステップ4: AI下書きを確認・編集

1. 録音が終わると、自動的に文字起こしとAI下書き生成が始まります
2. 生成された下書きを確認
3. 必要に応じて編集
   - 言葉を追加
   - 表現を修正
   - 段落を整える

#### ステップ5: 開封日時を設定

1. カレンダーから開封日を選択
2. 時刻を選択（例: 09:00）
3. 「開封日時を設定」ボタンをクリック

**開封日時の例:**

- 2030年4月1日 09:00（高校入学の日）
- 2035年1月15日 10:00（成人の日）
- 2040年6月1日 12:00（結婚記念日）

#### ステップ6: 手紙を保存

1. 「手紙を保存」ボタンをクリック
2. 暗号化処理が実行されます
3. OpenTimestampsによる証跡刻印が実行されます
4. 保存完了画面が表示されます

#### ステップ7: 共有リンクを送る

1. 「共有リンクを生成」ボタンをクリック
2. 共有リンクが生成されます（URLフラグメントに復号キーのシェアが含まれます）
3. 以下の方法で子どもに送ることができます：
   - 「LINEで送る」ボタン
   - 「メールで送る」ボタン
   - 「リンクをコピー」ボタン

**重要:** 共有リンクは必ず安全な方法で保管してください。このリンクを失うと、手紙を開封できなくなります。

---

### 手紙を開封する（受信者側）

#### ステップ1: 共有リンクにアクセス

1. 親から送られてきた共有リンクをクリック
2. ブラウザで開封ページが表示されます

#### ステップ2: 開封日時を待つ

開封日時前の場合：

- カウントダウンが表示されます
- 「あと○日○時間○分で開封できます」
- 手紙の内容は表示されません（技術的に復号不可能）

開封日時後の場合：

- 自動的に復号処理が実行されます
- 手紙の内容が表示されます

#### ステップ3: 手紙を読む

1. 手紙の本文が表示されます
2. 下部に証跡情報が表示されます
   - 証跡ハッシュ
   - 証跡タイムスタンプ
   - 証跡プロバイダー: OpenTimestamps
   - .otsファイルをダウンロード

---

### 手紙を管理する

#### 解錠コードの再発行（1回のみ）

解錠コードを紛失した場合や、セキュリティ上の理由で変更したい場合、**手紙が未開封であれば1回に限り**解錠コードと封筒（暗号化データ）を再発行できます。

1. 手紙詳細画面の「管理メニュー」から「解錠コードを再発行」を選択
2. 注意事項を確認して再発行を実行
3. **新しい解錠コード**と**新しい共有リンク**が生成されます
4. 古いコードとリンクは即座に無効化されます

#### 共有リンクの無効化（Revoke）

リンクが予期せぬ相手に渡ってしまった場合、リンクを無効化できます。

1. 手紙詳細画面の「管理メニュー」から「共有リンクを無効化」を選択
2. 実行すると、そのリンクからは誰もアクセスできなくなります

#### 手紙の削除

手紙そのものを完全に削除することも可能です。

1. 手紙詳細画面のゴミ箱アイコン（削除ボタン）をクリック
2. 確認ダイアログで「削除する」を選択
3. サーバーからすべてのデータ（暗号文、音声、画像）が削除され、復元不可能になります

#### 下書き一覧を確認

1. ヘッダーの「下書き」ボタンをクリック
2. 作成途中の手紙が一覧表示されます

#### 下書きから続きを書く

1. 下書きカードの「続きを書く」ボタンをクリック
2. 作成途中の状態から編集を再開できます

#### 下書きを削除

1. 下書きカードの「削除」ボタンをクリック
2. 確認ダイアログが表示されます
3. 「削除」ボタンをクリックして削除

---

### PWAとしてインストール

#### スマートフォン（iOS/Android）

1. Safariまたは Chrome で未来便にアクセス
2. ブラウザのメニューから「ホーム画面に追加」を選択
3. 「追加」をタップ
4. ホーム画面に「未来便」アイコンが追加されます

#### PC（Chrome/Edge）

1. アドレスバー右側の「インストール」アイコンをクリック
2. 「インストール」ボタンをクリック
3. デスクトップに「未来便」アイコンが追加されます

#### オフライン機能

- インストール後、オフライン時でも下書きを作成できます
- オンライン復帰時に自動的にサーバーに同期されます

---

## セキュリティとプライバシー

### 暗号化

**クライアント側暗号化（AES-GCM-256）**

手紙の内容は、ブラウザ上で暗号化されてからサーバーに送信されます。サーバーには暗号文のみが保存され、サーバー管理者でも内容を読むことはできません。

**暗号化の流れ:**

1. ブラウザで手紙を作成
2. Web Crypto APIでAES-GCM-256暗号化
3. 暗号文をサーバーに送信
4. サーバーは暗号文を保存（復号キーは保存しない）

### Shamir分割

**復号キーの分割:**

復号キーは、Shamir's Secret Sharingによって3つのシェアに分割されます。そのうち2つのシェアがないと復号できません。

- **シェア1（clientShare）**: URLフラグメントに含まれる
- **シェア2（serverShare）**: サーバーが保持（開封日時後にのみ提供）
- **シェア3（backupShare）**: バックアップ用（オプション）

**開封日時の技術的制限:**

開封日時前は、サーバーがserverShareを提供しないため、clientShareだけでは復号できません。これにより、開封日時前に手紙を読むことは技術的に不可能です。

### OpenTimestamps証跡

手紙のハッシュ（SHA-256）がBitcoinブロックチェーンに刻印されます。これにより、以下のことが証明できます：

- 手紙が特定の日時に存在していたこと
- 手紙が改ざんされていないこと

証跡情報は、手紙の下部に表示されます。.otsファイルをダウンロードして、第三者機関で検証することも可能です。

### プライバシー

- 音声ファイルはS3に暗号化されて保存されます
- 手紙の内容はサーバー管理者でも読めません
- 共有リンクを知っている人だけが手紙にアクセスできます
- Bot（SNSプレビュー、クローラー）は自動的に除外されます

詳細は[プライバシーポリシー](/privacy)をご覧ください。

---

## よくある質問

### Q1: 開封日時を過ぎたら、いつでも手紙を読めますか？

**A:** はい。開封日時を過ぎれば、いつでも何度でも手紙を読むことができます。共有リンクを保管しておいてください。

### Q2: 共有リンクを失くしてしまいました。どうすればいいですか？

**A:** 未開封の手紙であれば、**1回に限り**解錠コードを再発行できます。詳細画面のメニューから行ってください。再発行もできない場合は、作成時に保存した「バックアップコード」を使用してください。それも無い場合は、セキュリティの仕様上、手紙を開封することはできません。

### Q3: 開封日時を変更できますか？

**A:** 現在のバージョンでは、開封日時の変更機能は実装されていません。手紙を保存する前に、慎重に開封日時を設定してください。

### Q4: 手紙の内容を後から編集できますか？

**A:** 内容の直接編集はできませんが、一度手紙を削除して、下書き（または新規作成）から書き直すことは可能です。

### Q5: 音声ファイルも一緒に保存されますか？

**A:** はい。音声ファイルはS3に暗号化されて保存されます。ただし、現在のバージョンでは、受信者が音声を再生する機能は実装されていません。

### Q6: 複数の子どもに別々の手紙を送れますか？

**A:** はい。それぞれの子どもに対して、別々の手紙を作成できます。テンプレートや開封日時も個別に設定できます。

### Q7: 手紙の文字数制限はありますか？

**A:** 特に制限はありませんが、読みやすさを考慮して、適度な長さにすることをお勧めします。

### Q8: オフラインで手紙を作成できますか？

**A:** PWAとしてインストールすれば、オフライン時でも下書きを作成できます。オンライン復帰時に自動的にサーバーに同期されます。

### Q9: 手紙が改ざんされていないことを証明できますか？

**A:** はい。OpenTimestampsによって、手紙のハッシュがBitcoinブロックチェーンに刻印されます。.otsファイルをダウンロードして、第三者機関で検証できます。

### Q10: サーバー管理者は手紙の内容を読めますか？

**A:** いいえ。手紙の内容はクライアント側で暗号化されてからサーバーに送信されます。サーバーには暗号文のみが保存され、復号キーは保存されないため、サーバー管理者でも内容を読むことはできません。

---

## トラブルシューティング

### 録音ができない

**原因:**

- マイクへのアクセスが許可されていない
- マイクが接続されていない
- ブラウザがマイクに対応していない

**解決方法:**

1. ブラウザの設定でマイクへのアクセスを許可してください
2. マイクが正しく接続されているか確認してください
3. Chrome、Edge、Safari、Firefoxなどの最新ブラウザを使用してください

### 文字起こしが正確でない

**原因:**

- 録音環境が騒がしい
- マイクの音質が悪い
- 話し方が早すぎる、または不明瞭

**解決方法:**

1. 静かな場所で録音してください
2. マイクに近づきすぎず、20〜30cm程度の距離を保ってください
3. ゆっくり、はっきりと話してください
4. 文字起こし後に編集画面で修正できます

### AI下書きが期待と異なる

**原因:**

- 録音内容が不明瞭
- テンプレートが適切でない

**解決方法:**

1. 編集画面で自由に修正できます
2. 録音をやり直して、より具体的に話してください
3. 別のテンプレートを試してください

### 共有リンクが開けない

**原因:**

- URLが正しくコピーされていない
- URLフラグメント（`#key=xxx`）が欠けている

**解決方法:**

1. 共有リンクを再度コピーしてください
2. URLフラグメント（`#key=xxx`）が含まれているか確認してください
3. LINEやメールで送信する際に、URLが途中で切れていないか確認してください

### 開封日時を過ぎても手紙が開封できない

**原因:**

- ブラウザの時刻設定が正しくない
- サーバーの時刻設定が正しくない

**解決方法:**

1. ブラウザの時刻設定を確認してください
2. 数分待ってから再度アクセスしてください
3. それでも解決しない場合は、お問い合わせください

### PWAがインストールできない

**原因:**

- ブラウザがPWAに対応していない
- HTTPSでアクセスしていない

**解決方法:**

1. Chrome、Edge、Safariなどの最新ブラウザを使用してください
2. HTTPSでアクセスしているか確認してください（`https://`で始まるURL）

---

## お問い合わせ

ご不明な点やトラブルがございましたら、以下の方法でお問い合わせください：

- **メール**: support@mirai-bin.example.com
- **フィードバックフォーム**: [お問い合わせページ](/contact)

---

## 利用規約・プライバシーポリシー

- [利用規約](/terms)
- [プライバシーポリシー](/privacy)

---

**未来便**は、親から子への想いを、未来に確実に届けるためのサービスです。大切な手紙を、安全に、温かく保管します。
